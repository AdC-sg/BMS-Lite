export default {
  async fetch(request, env, ctx) {
    // Only handle POST requests
    if (request.method !== 'POST') {
      return new Response('Method not allowed', { status: 405 });
    }

    try {
      // Get the FormSG data
      const formData = await request.json();
      
      // Extract the data from FormSG webhook
      const userData = {
        fullName: formData.data.find(field => field.question === '[MyInfo] Name')?.answer || '',
        organization: formData.data.find(field => field.question === 'My Organisation')?.answer || '',
        playStoreEmail: formData.data.find(field => field.question === 'PlayStore Email')?.answer || '',
        appStoreEmail: formData.data.find(field => field.question === 'App Store Email')?.answer || '',
        dateReceived: new Date().toISOString().split('T')[0]
      };

      // Forward to your local dashboard (you'll need to update this URL)
      const dashboardResponse = await fetch('https://your-dashboard-url.com/webhook', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(userData)
      });

      return new Response('OK', { status: 200 });
    } catch (error) {
      console.error('Webhook error:', error);
      return new Response('Internal Server Error', { status: 500 });
    }
  },
};
